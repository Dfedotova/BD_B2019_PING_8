# Задание 5.## Беловицкий Владислав БПИ198## Задача 1.```readers ( number, last_name, first_name, birth_date, address )books ( isbn, title, year, page_count, publisher_name )publishers ( name, address )categories ( name, parent_name )copies ( number, isbn, position )bookings ( reader_number, copy_number, isbn, return_date )book_categories ( isbn, category_name )```### 1. Показать все названия книг вместе с именами издателей.``` sqlSELECT title, publisher_name FROM books```### 2. В какой книге наибольшее количество страниц?``` sqlSELECT isbn, title, page_countFROM booksWHERE page_count = (SELECT MAX(page_count) from books)```### 3. Какие авторы написали более 5 книг?``` sqlSELECT authorFROM booksGROUP BY authorHAVING COUNT(*) > 5```### 4. В каких книгах более чем в два раза больше страниц, чем среднее количество страниц для всех книг?``` sqlSELECT isbn, titleFROM booksWHERE page_count > (SELECT AVG(page_count) FROM books) * 2```### 5. Какие категории содержат подкатегории?``` sqlSELECT DISTINCT parent_nameFROM categoriesWHERE parent_name IS NOT NULL```### 6. У какого автора (предположим, что имена авторов уникальны) написано максимальное количество книг?``` sqlSELECT DISTINCT authorFROM booksWHERE author =    (SELECT author     FROM books     GROUP BY author     ORDER BY count(*) desc     LIMIT 1    )```### 7. Какие читатели забронировали все книги (не копии), написанные "Марком Твеном"?``` sqlSELECT rb.number    FROM (SELECT r.number, COUNT(*) bookings_count        FROM readers r        JOIN bookings bs on bs.reader_number = r.number        JOIN books b on b.isbn = bs.isbn        WHERE b.author = 'Марк Твен'        GROUP BY r.number        ) rbWHERE rb.bookings_count = (    SELECT COUNT(isbn)    FROM books    WHERE author = 'Марк Твен'    )```### 8. Какие книги имеют более одной копии?``` sqlSELECT b.isbn, b.titleFROM books bJOIN copies c on c.isbn = b.isbnGROUP BY b.isbnHAVING count(*) > 1```### 9. ТОП 10 самых старых книг``` sqlSELECT isbn, title, yearFROM booksORDER BY yearLIMIT 10```### 10. Перечислите все категории в категории “Спорт” (с любым уровнем вложености).``` sqlWITH RECURSIVE sport_categories AS(  SELECT name, parent_name FROM categories WHERE name = 'Sport'  UNION ALL  SELECT sub_categories.name, sub_categories.parent_name  FROM categories sub_categories  JOIN sport_categories ON sport_categories.name = sub_categories.parent_name)SELECT sport_categories.name, sport_categories.parent_nameFROM sport_categories```## Задача 2Напишите SQL-запросы для следующих действий:### 1. Добавьте запись о бронировании читателем ‘Василеем Петровым’ книги с ISBN 123456 и номером копии 4.``` sqlINSERT INTO bookings (reader_number, isbn, copy_number, return_date)SELECT number, '123456', 4, (NOW() + interval '14' day)FROM readersWHERE first_name = 'Василий' AND last_name = 'Петров'```### 2. Удалить все книги, год публикации которых превышает 2000 год.``` sqlBEGIN TRANSACTION;DELETE FROM bookingsWHERE isbn IN (SELECT isbn FROM books WHERE year > 2000);DELETE FROM copiesWHERE isbn IN (SELECT isbn FROM books WHERE year > 2000);DELETE FROM book_categoriesWHERE isbn IN (SELECT isbn FROM books WHERE year > 2000);DELETE FROM booksWHERE isbn IN (SELECT isbn FROM books WHERE year > 2000);COMMIT TRANSACTION;```### 3. Измените дату возврата для всех книг категории "Базы данных", начиная с 01.01.2016, чтобы они были в заимствовании на 30 дней дольше (предположим, что в SQL можно добавлять числа к датам).``` sqlUPDATE bookingsSET return_date = return_date + interval '30' dayWHERE return_date >= TO_DATE('01.01.2016', 'DD.MM.YYYY') AND isbn IN    (SELECT isbn FROM book_categories WHERE category_name = 'Базы Данных')```## Задача 3Рассмотрим следующую реляционную схему:```Student ( MatrNr, Name, Semester )Check ( MatrNr, LectNr, ProfNr, Note )Lecture ( LectNr, Title, Credit, ProfNr )Professor ( ProfNr, Name, Room )```Опишите на русском языке результаты следующих запросов:### 1.``` sqlSELECT s.Name, s.MatrNr FROM Student s   WHERE NOT EXISTS (     SELECT * FROM Check c WHERE c.MatrNr = s.MatrNr AND c.Note >= 4.0 ) ; ```Найти студентов (имя и номер), у которых нет оценок равных или больших 4.### 2.``` sql( SELECT p.ProfNr, p.Name, sum(lec.Credit) FROM Professor p, Lecture lec WHERE p.ProfNr = lec.ProfNrGROUP BY p.ProfNr, p.Name)UNION( SELECT p.ProfNr, p.Name, 0 FROM Professor pWHERE NOT EXISTS (   SELECT * FROM Lecture lec WHERE lec.ProfNr = p.ProfNr )); ```Для каждого профессора (номер, имя) вывести сумму кредитов лекций, которые он ведет. Считать сумму нулевой, если профессор не ведет ни одной лекции. ### 3.``` sqlSELECT s.Name, p.Note  FROM Student s, Lecture lec, Check c  WHERE s.MatrNr = c.MatrNr AND lec.LectNr = c.LectNr AND c.Note >= 4     AND c.Note >= ALL (       SELECT c1.Note FROM Check c1 WHERE c1.MatrNr = c.MatrNr ) ```Для каждого студента (имя), найти его наибольшие оценки, но не ниже 4.