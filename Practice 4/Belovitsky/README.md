# Задание 4.## Беловицкий Владислав БПИ198---Примечание: не стал ставить отбивки в markdown, чтобы не портить запросы, см. исходный файл.## Задача 1.Reader (ID, LastName, FirstName, Address, BirthDate)Book (ISBN, Title, Author, PagesNum, PubYear, PubName)Publisher (PubName, PubAdress)Category (CategoryName, ParentCat)Copy (ISBN, CopyNumber, ShelfPosition)Borrowing (ReaderNr, ISBN, CopyNumber, ReturnDate)BookCat (ISBN, CategoryName )### а) Какие фамилии читателей в Москве?SELECT LastNameFROM ReaderWHERE Address = 'Москва'### б) Какие книги (author, title) брал Иван Иванов?SELECT b.Author	,b.TitleFROM Borrowing brwJOIN Book b ON b.ISBN = brw.ISBNJOIN Reader r ON r.ID = brw.ReaderNrWHERE r.FirstName = 'Иван' AND r.LastName = 'Иванов'### в) Какие книги (ISBN) из категории "Горы" не относятся к категории "Путешествия"? Подкатегории не обязательно принимать во внимание!#### Вариант 1 (без учета подкатегорий)SELECT b.ISBNFROM Book bJOIN BookCat bc ON bc.ISBN = b.ISBNWHERE bc.CategoryName = 'Горы' AND bc.CategoryName != 'Путешествия'#### Вариант 2 (с учетом подкатегорий)Не тестировал, но должно быть примерно так (WITH REQURSIVE взят из PostrgreSql). Рекурсивно достаем подкатегории категории 'Путешествия' и вычитаем это множество из категорий книги. <br>WITH REQURSIVE CategoryWithСhildren  (CategoryName, ParentCat)AS (  --корневая категория  SELECT	CategoryName, ParentCat  FROM Category  WHERE CategoryName = 'Путешествия'    UNION --ALL  SELECT	CategoryName, ParentCat  FROM Category c  JOIN CategoryWithСhildren cwc ON cwc.CategoryName = c.ParentCat)SELECT b.ISBNFROM Book bJOIN BookCat bc ON bc.ISBN = b.ISBNLEFT JOIN CategoryWithСhildren cwc ON cwc.CategoryName = bc.CategoryNameWHERE bc.CategoryName = 'Горы' AND cwc.CategoryName IS NULL### г) Какие читатели (LastName, FirstName) брали книги, которые были возвращены?SELECT r.LastName	,r.FirstNameFROM Reader rJOIN Borrowing br ON br.ReaderNr = r.IDWHERE br.ReturnDate <= GETDATE()--или так:--br.ReturnDate IS NOT NULL####д) Какие читатели (LastName, FirstName) брали хотя бы одну книгу, которую брал также Иван Иванов (не включайте Ивана Иванова в результат)?SELECT r.LastName	,r.FirstNameFROM Reader rJOIN Borrowing br ON br.ReaderNr = r.IDJOIN     (        SELECT TOP(1) brt.ISBN, rt.ID        FROM Reader rt        JOIN Borrowing brt ON brt.ReaderNr = rt.ID        WHERE rt.FirstName = 'Иван' AND rt.LastName = 'Иванов'    ) AS tempReaderBookON br.ISBN = tempReaderBook.ISBN AND r.ID != tempReaderBook.ID