# Базы данных
## Домашнее задание 1
### Шалаева Марина БПИ198

#### Условие

Вам поручено разработать онлайн-аукцион. Он позволяет продавцам продавать свои товары с помощью аукциона. Покупатели делают ставки. Выигрывает последняя самая высокая ставка. После закрытия аукциона победитель оплачивает товар с помощью кредитной карты. Продавец отвечает за доставку товара покупателю.

* Предложите список функциональных требований для проекта.
* Определите роли пользователей и действия для каждой роли.
* Определите объекты, о которых будут храниться данные.
* Определите связи между объектами для хранения данных.
* Нарисуйте схему объектной модели (используя любые обозначения, которые вам удобны).

#### Требования к функциональным характеристикам

##### Требования к составу выполняемых функций

Функциями, которые должна предоставлять разрабатываемая программа, являются:

1) Регистрация пользователя. У пользователя должны быть запрошены следующие обязательные данные для успешной регистрации:

	* Имя;
	* Фамилия;
	* Отчество (при наличии);
	* Номер мобильного телефона;
	* E-mail (адрес электронной почты);
	* Пароль, содержащий в себе хотя бы одну цифру и букву и не менее 8 символов;
	* Паспортные данные для подтверждения дееспособности пользователя

   И также следующие необязательные данные:
   
	* Адрес для доставки товара;

2) Обязательная авторизация пользователя;

3) Пользователи должны делиться по ролям: покупатель, продавец, администратор. 

4) Один пользователь может реализовывать несколько ролей;

5) Любой авторизованный пользователь может просмотреть список доступных и запланированных аукционов;

6) Покупатель может:

	1) *Изменять данные в личном кабинете*
	2) *Регистрироваться на аукцион*
	3) *Запрашивать уведомления о начале торгов в качестве письма на электронный адрес почты*
	4) *Просматривать данные о товаре*
	5) *Просматривать ставки других участников*
	6) *Вносить собственные ставки. Должны быть больше уже представленных ставок на текущих торгах*
	7) *Выставлять максимальную приемлемую цену на определенный товар*
	8) *Возможность включения функции автоматического выхода из аукциона после того, как ставки других участников становятся больше максимального приемлемого для покупателя значения*
	9) *Выставлять оценку продавцам*
	10) *Оставлять отзывы о товарах*
	11) *Ставить электронную подпись*
	12) *Осуществлять электронный платеж*
	13) *Выбирать способ доставки*
	14) *Общаться с продавцом в чате*
	15) *Обращаться к администратору по интересующим вопросам с помощью чата*
	16) *Подавать жалобу на продавца*
    
7) Продавец может:
	1) *Выставлять товар на продажу*
	2) *Выбирать валюту для проведения торгов*
	3) *Устанавливать начальную цену лота*
	4) *Устанавливать блиц-цену (цена, при достижении которой аукцион досрочно заканчивается)*
	5) *Общаться с покупателем с помощью чата*
	6) *Общаться с администратором с помощью чата*
	7) *Подавать жалобу на покупателя*

8) Администратор может:
	1) *Общаться с покупателями и продавцами с помощью чата*
	2) *Остлеживать протекание любого аукциона*
	3) *Разрешать споры покупателя и продавца при подаче жалобы любой из сторон*
	4) *Выставлять дату и время проведения аукционов*
    
9) Личный кабинет любого пользователя должен состоять из следующих «закладок»:

	* «Персональные данные» — поля с данными, указанные в пункте 1 (регистрация пользователя), с возможностью изменения информации;
	* «История» — страница, содержащая в себе список аукционов, в которых участвовал пользователь; список собственных ставок на торгах (для покупателя) и список ставок участвовавших в аукционе покупателей (для продавца);
	* «Список доступных для общения чатов» — список начатых пользователем диалогов. Должна быть возможность создать новый чат;

10) Если пользователь согласился купить товар по блиц-цене, торги прекращаются и товар присваивается пользователю;

11) По истечении времени проведения аукциона необходимо зафиксировать самую высокую ставку. Ее инициатор становится обладателем товара;

12) После выигранных торгов или соглашения на приобретение товара за блиц-цену нужно предложить покупателю связаться с продавцом, а продавцу — с покупателем;

11) Программа должна предоставлять возможность онлайн-оплаты с помощью банковской карты.

#### Список и описание функциональных требований сущностей

| Название     | Назначение                                               |
|:-------------|:---------------------------------------------------------|
| Product      | Сущность, представляющая из себя товар, разыгрываемый на аукционе |
| Status       | Сущность, представляющая из себя статус товара: свободен и готов к выставлению на аукцион (ready), продан участнику аукциона (sold), отправлен покупателю (sent), доставлен (delivered) |
| Bet          | Сущность, представляющая из себя одну ставку на аукционе |
| User         | Сущность, представляющая из себя участника аукциона      |
| Role         | Сущность, содержащая в себе роль участника аукциона: покупатель (buyer), продавец (seller), администратор сайта (administrator) |
| UserChats    | Сущность, представляющая из себя таблицу начатых тем или иным пользователем чатов |

#### Описание и функциональное назначение полей, методов и свойств классов

##### Описание свойств сущности Product
|Имя         |Модификатор доступа| Тип         | Назначение |
|:-----------|:------------------|:------------|:-----------|
|Id          | public            | int         | Идентификационный номер товара |
|Name        | public            | string      | Наименование товара |
|Seller      | public            | User        | Аккаунт продавца товара |
|Description | public            | string      | Описание товара     |
|Model       | public            | string      | Модель товара (может отсутствовать) |
|Price       | public            | double      | Стартовая цена товара |
|BlitzPrice  | public            | double      | Блиц-цена товара |
|Picture     | public            | string      | Ссылка на фото товара |
|Status      | public            | Status      | Текущий статус товара |

##### Описание констант сущности Status
| Имя       | Значение | Назначение                                      |    
|:----------|:---------|:------------------------------------------------|
| Undefined | 0        | Значение не определено                          |
| Ready     | 1        | Товар свободен и готов к выставлению на аукцион |
| Sold      | 2        | Товар продан участнику аукциона (покупателю)    |
| Sent      | 3        | Товар отправлен покупателю                      |
| Delivered | 4        | Товар доставлен                                 |

##### Описание свойств сущности Bet
| Имя          |Модификатор доступа| Тип      | Назначение |
|:-------------|:------------------|:---------|:-----------|
| Id           | public            | int      | Идентификационный номер ставки |
| Owner        | public            | User     | Инициатор ставки        |
| Product      | public            | Product  | Товар, на который была сделана ставка |
| NominalValue | public            | double   | Размер ставки (номинал) |
| Currency     | public            | string   | Валюта                  |
| IsHighest    | public            | bool     | Является ли ставка наибольшей на данный момент |

#### Описание свойств сущности User
| Имя          |Модификатор доступа| Тип      | Назначение |
|:-------------|:------------------|:---------|:-----------|
| Id           | public            | int      | Идентификационный номер участника аукциона |
| Name         | public            | string   | Имя участника аукциона |
| Surname      | public            | string   | Фамилия участника аукциона |
| Patronymic   | public            | string   | Отчество участника аукциона |
| PhoneNumber  | public            | string   | Номер телефона участника аукциона |
| Email        | public            | string   | Почта участника аукциона |
| Password     | public            | string   | Пароль участника аукциона |
| Role         | public            | Role     | Роль участника аукциона: покупатель (buyer), продавец (seller) или администратор сайта (administrator) |
| Address      | public            | string   | Адрес доставки (может быть null у производителя и администратора)|

##### Описание констант сущности Role
| Имя          | Значение | Назначение              |    
|:-------------|:---------|:------------------------|
| Undefined    | 0        | Значение не определено  |
| Buyer        | 1        | Покупатель              |
| Seller       | 2        | Продавец товара         |
| Administrator| 3        | Админисратор сайта      |


##### Описание свойств сущности UserChats
| Имя          |Модификатор доступа| Тип      | Назначение |
|:-------------|:------------------|:---------|:-----------|
| Id           | public            | int      | Идентификационный номер строчки таблицы |
| User         | public            | User     | Пользователь |
| Interlocutor | public            | User     | Собеседник пользователя, с которым была начата беседа |

#### Взаимодействие между сущностями

##### Общая концепция

Взаимодействие и связи всех сущностей представлены на рисунке 1.

Примечание: dbdesigner не предоставляет возможности выбора типов объектов не из списка, а в представленном мной решении предполагается использование собственных классов. Поэтому в типе «text(...)» на рисунке 1 нужно смотреть только на то, что в скобках — там написано название нужного класса.

##### Взаимодействие между User'ами

Взаимодействие между несколькими пользователями происходит с помощью таблицы UserChats. Оно представлено на рисунке 2. Если пользователь хочет начать новый диалог, то в таблице UserChats появится новая строчка, в который инициатор беседы попадет в поле User, а его собеседник — в поле Interlocutor. Для получения списка всех диалогов пользователя нужно будет найти все строчки в базе данных UserChats, в которых интересующий нас пользователь находится либо в поле User, либо в поле Interlocutor. Например, при попытке получить все диалоги пользователя с Id = 4, нам будут удовлетворять строчки 1, 2, 3 из таблицы UserChats. Таким образом, у пользователя с Id = 4 начатые чаты будут с пользователями с Id = 1, 3 и 5.
